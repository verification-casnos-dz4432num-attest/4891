<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
// Fonction pour décrypter le token AES
function decryptAES(encryptedText) {
    const key = CryptoJS.enc.Utf8.parse("vGX8!jkd72p$1234"); // 16 caractères
    const decrypted = CryptoJS.AES.decrypt(
        decodeURIComponent(encryptedText), // On décode proprement l'URL
        key,
        {
            mode: CryptoJS.mode.ECB,
            padding: CryptoJS.pad.Pkcs7
        }
    );
    return decrypted.toString(CryptoJS.enc.Utf8);
}

// Récupérer les paramètres de l'URL
const urlParams = new URLSearchParams(window.location.search);
const clientId = urlParams.get("id");
const token = urlParams.get("token");

// Afficher dans la console pour vérifier les valeurs reçues
console.log("ID reçu :", clientId);
console.log("Token avant déchiffrement :", token);

if (clientId && token) {
    try {
        // Déchiffrer le token
        let decryptedToken = decryptAES(token);
        console.log("Token déchiffré :", decryptedToken);

        // Vérifier si le token est valide
        if (decryptedToken === clientId) {
            document.body.innerHTML = `
                <h2>Vérification réussie ✅</h2>
                <p>ID : ${clientId}</p>
            `;
        } else {
            document.body.innerHTML = `
                <h2>Client non validé ❌</h2>
                <p>Mauvais token</p>
            `;
        }
    } catch (error) {
        console.error("Erreur lors du déchiffrement :", error);
        document.body.innerHTML = `
            <h2>Erreur ❌</h2>
            <p>Impossible de déchiffrer le token.</p>
        `;
    }
} else {
    document.body.innerHTML = `
        <h2>Paramètres manquants ❌</h2>
        <p>Veuillez fournir un ID et un token.</p>
    `;
}
</script>
